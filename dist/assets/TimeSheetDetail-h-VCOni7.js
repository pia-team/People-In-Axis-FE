import{j as e,g as a,O as A,D as G,a8 as m,V as l,a2 as ce,a3 as ue,a4 as U,a5 as o,a6 as de,aa as me,ab as he,ac as je,L as ge,F as pe,q as xe}from"./mui-CYe98n_K.js";import{l as Re,u as be,c as i}from"./vendor-XBP3t-ED.js";import{u as Ce,b as I,t as r}from"./index--2Lk4t6e.js";import{u as c}from"./useMutation-DaHtIydk.js";import{P as Se}from"./PageContainer-BfQWlLPL.js";import{S as ye}from"./SectionCard-4aLOeFJ3.js";import{C as p}from"./ConfirmDialog-Xg6DaLa-.js";import"./utils-BgeKWveL.js";const Ie=()=>{const{id:n}=Re(),k=be(),{hasRole:X}=Ce(),Z=t=>t==="COMPLETED"?"Closed":t||"-",{data:s,isLoading:ee,isError:te,refetch:x}=I({queryKey:["timesheet",n],queryFn:async()=>r.getById(Number(n)),enabled:!!n}),P=c({mutationFn:()=>r.submit(Number(n)),onSuccess:()=>x()}),R=c({mutationFn:t=>r.cancel(Number(n),t),onSuccess:()=>x()}),b=c({mutationFn:t=>r.companyAction(Number(n),"reject",t),onSuccess:()=>x()}),{data:C,refetch:g}=I({queryKey:["timesheet",n,"rows"],queryFn:async()=>r.getRows(Number(n),{page:0,size:100}),enabled:!!n}),[S,M]=i.useState(!1),{data:y}=I({queryKey:["timesheet",n,"history",S],queryFn:async()=>r.getHistory(Number(n)),enabled:!!n&&S}),F=c({mutationFn:t=>r.createRow(Number(n),t),onSuccess:()=>g()}),se=c({mutationFn:t=>r.deleteRow(Number(n),t),onSuccess:()=>g()}),E=c({mutationFn:({rowId:t,assigneeEmployeeId:d})=>r.assignRow(Number(n),t,d),onSuccess:()=>g()}),O=c({mutationFn:({rowId:t,comments:d})=>r.approveRow(Number(n),t,d),onSuccess:()=>g()}),f=c({mutationFn:({rowId:t,reason:d})=>r.rejectRow(Number(n),t,d),onSuccess:()=>g()}),L=c({mutationFn:()=>r.cloneTimesheet(Number(n)),onSuccess:t=>k(`/timesheets/${t.id}`)}),[w,_]=i.useState(""),[H,$]=i.useState(""),[q,W]=i.useState(""),[ne,D]=i.useState(!1),[h,z]=i.useState(""),[ie,N]=i.useState(!1),[B,J]=i.useState(""),[ae,T]=i.useState(!1),[V,oe]=i.useState(null),[u,K]=i.useState(""),[re,v]=i.useState(!1),[Q,le]=i.useState(null),[j,Y]=i.useState("");return e.jsxs(Se,{title:"TimeSheet Detail",actions:e.jsxs(A,{direction:"row",spacing:1,children:[e.jsx(l,{variant:"outlined",onClick:()=>k("/timesheets"),children:"Back"}),e.jsx(l,{variant:"text",onClick:()=>M(!0),children:"History"}),e.jsx(l,{variant:"contained",onClick:()=>P.mutate(),disabled:!s||!["DRAFT","REVISION_REQUESTED"].includes(String(s==null?void 0:s.status))||P.isPending,children:"Submit"}),e.jsx(l,{variant:"outlined",color:"error",onClick:()=>{z(""),D(!0)},disabled:!s||String(s==null?void 0:s.baseStatus)!=="CREATED"||R.isPending,children:"Cancel"}),X("COMPANY_MANAGER")&&s&&String(s.baseStatus)==="CREATED"&&e.jsx(l,{variant:"outlined",color:"error",onClick:()=>{J(""),N(!0)},disabled:b.isPending,children:"Company Reject"}),s&&String(s.baseStatus)==="ADMIN_REJECTED"&&e.jsx(l,{variant:"outlined",onClick:()=>L.mutate(),disabled:L.isPending,children:"Clone"})]}),children:[e.jsxs(ye,{children:[ee&&e.jsx(a,{variant:"body1",children:"Loading..."}),te&&e.jsx(a,{variant:"body1",color:"error",children:"Failed to load timesheet."}),s&&e.jsxs(A,{spacing:1,children:[e.jsxs(a,{variant:"h6",children:[s.employeeName," - ",s.projectName]}),e.jsx(G,{sx:{my:1}}),e.jsxs(a,{children:["Date: ",s.workDate]}),e.jsxs(a,{children:["Hours: ",s.hoursWorked]}),s.overtimeHours!==void 0&&e.jsxs(a,{children:["Overtime: ",s.overtimeHours]}),e.jsxs(a,{children:["Status: ",s.status||"-"]}),e.jsxs(a,{children:["Base Status: ",Z(String(s.baseStatus))]}),e.jsxs(a,{children:["Billable: ",s.billable?"Yes":"No"]}),e.jsxs(a,{children:["Task: ",s.taskDescription||"-"]}),e.jsx(G,{sx:{my:2}}),e.jsx(a,{variant:"h6",children:"Rows"}),String(s.baseStatus)==="CREATED"&&e.jsxs(A,{direction:"row",spacing:1,alignItems:"center",sx:{mb:1},children:[e.jsx(m,{size:"small",label:"Work Date",type:"date",value:w,onChange:t=>_(t.target.value),InputLabelProps:{shrink:!0}}),e.jsx(m,{size:"small",label:"Hours",type:"number",value:H,onChange:t=>$(t.target.value)}),e.jsx(m,{size:"small",label:"Task",value:q,onChange:t=>W(t.target.value)}),e.jsx(l,{variant:"contained",onClick:()=>{const t=Number(H);!w||!t||(F.mutate({workDate:w,hours:t,taskDescription:q}),_(""),$(""),W(""))},disabled:F.isPending,children:"Add Row"})]}),e.jsxs(ce,{size:"small",children:[e.jsx(ue,{children:e.jsxs(U,{children:[e.jsx(o,{children:"ID"}),e.jsx(o,{children:"Date"}),e.jsx(o,{children:"Hours"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Assigned To"}),e.jsx(o,{align:"right",children:"Actions"})]})}),e.jsx(de,{children:((C==null?void 0:C.content)??[]).map(t=>e.jsxs(U,{children:[e.jsx(o,{children:t.id}),e.jsx(o,{children:t.workDate}),e.jsx(o,{children:t.hours}),e.jsx(o,{children:t.status}),e.jsx(o,{children:t.assignedToName||"-"}),e.jsxs(o,{align:"right",children:[String(s.baseStatus)==="CREATED"&&e.jsx(l,{size:"small",color:"error",onClick:()=>se.mutate(t.id),children:"Delete"}),e.jsx(l,{size:"small",onClick:()=>{oe(t.id),K(""),T(!0)},disabled:String(s.baseStatus)!=="CREATED"||E.isPending||!!t.assignedToEmployeeId,children:"Assign"}),e.jsx(l,{size:"small",onClick:()=>O.mutate({rowId:t.id}),disabled:String(s.baseStatus)!=="CREATED"||O.isPending||["TEAM_LEAD_APPROVE","TEAM_LEAD_REJECT","COMPLETED","ADMIN_REJECTED"].includes(String(t.status)),children:"Approve"}),e.jsx(l,{size:"small",color:"error",onClick:()=>{le(t.id),Y(""),v(!0)},disabled:String(s.baseStatus)!=="CREATED"||f.isPending||["TEAM_LEAD_APPROVE","TEAM_LEAD_REJECT","COMPLETED","ADMIN_REJECTED"].includes(String(t.status)),children:"Reject"})]})]},t.id))})]})]})]}),e.jsx(p,{open:ne,title:"Cancel Timesheet",description:"Please provide a reason for cancellation.",confirmLabel:"Cancel",confirmColor:"error",loading:R.isPending,confirmDisabled:h.trim().length===0,onClose:()=>D(!1),onConfirm:()=>{h.trim()&&(R.mutate(h.trim()),D(!1))},children:e.jsx(m,{autoFocus:!0,fullWidth:!0,label:"Reason",multiline:!0,minRows:2,value:h,error:h.trim().length===0,helperText:h.trim().length===0?"Reason is required":"",onChange:t=>z(t.target.value)})}),e.jsx(p,{open:ie,title:"Company Reject",description:"Optionally provide a company reject note.",confirmLabel:"Reject",confirmColor:"error",loading:b.isPending,onClose:()=>N(!1),onConfirm:()=>{b.mutate(B.trim()),N(!1)},children:e.jsx(m,{autoFocus:!0,fullWidth:!0,label:"Note (optional)",multiline:!0,minRows:2,value:B,onChange:t=>J(t.target.value)})}),e.jsx(p,{open:ae,title:"Assign Row",description:"Provide an employee ID to assign.",confirmLabel:"Assign",confirmColor:"primary",loading:E.isPending,confirmDisabled:u.trim()===""||Number.isNaN(Number(u)),onClose:()=>T(!1),onConfirm:()=>{const t=Number(u);V&&!isNaN(t)&&(E.mutate({rowId:V,assigneeEmployeeId:t}),T(!1))},children:e.jsx(m,{autoFocus:!0,fullWidth:!0,type:"number",label:"Employee ID",value:u,error:u.trim()===""||Number.isNaN(Number(u)),helperText:u.trim()===""||Number.isNaN(Number(u))?"Valid employee ID is required":"",onChange:t=>K(t.target.value)})}),e.jsx(p,{open:re,title:"Reject Row",description:"Please provide a reason for rejection.",confirmLabel:"Reject",confirmColor:"error",loading:f.isPending,confirmDisabled:j.trim().length===0,onClose:()=>v(!1),onConfirm:()=>{Q&&j.trim()&&(f.mutate({rowId:Q,reason:j.trim()}),v(!1))},children:e.jsx(m,{autoFocus:!0,fullWidth:!0,label:"Reason",multiline:!0,minRows:2,value:j,error:j.trim().length===0,helperText:j.trim().length===0?"Reason is required":"",onChange:t=>Y(t.target.value)})}),e.jsxs(me,{open:S,onClose:()=>M(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(he,{children:"TimeSheet History"}),e.jsxs(je,{children:[!y&&e.jsx(a,{variant:"body2",color:"text.secondary",children:"Loading..."}),y&&e.jsx(ge,{children:y.map((t,d)=>e.jsx(pe,{divider:!0,children:e.jsx(xe,{primary:`${t.type} | ${t.createdAt} | ${t.oldStatus??"-"} â†’ ${t.newStatus??"-"}`,secondary:`Actor: ${t.actorEmployeeName??"-"} (${t.actorEmployeeId??"-"})${t.rowId?` | Row: ${t.rowId}`:""}${t.reason?` | Reason: ${t.reason}`:""}`})},d))})]})]})]})};export{Ie as default};
//# sourceMappingURL=TimeSheetDetail-h-VCOni7.js.map
