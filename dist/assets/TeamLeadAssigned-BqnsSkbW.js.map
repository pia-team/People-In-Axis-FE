{"version":3,"file":"TeamLeadAssigned-BqnsSkbW.js","sources":["../../src/pages/timesheets/TeamLeadAssigned.tsx"],"sourcesContent":["import React from 'react';\nimport { Box, Typography, Stack, Button, TextField } from '@mui/material';\nimport { DataGrid, GridColDef, GridPaginationModel } from '@mui/x-data-grid';\nimport { useQuery, useMutation, keepPreviousData } from '@tanstack/react-query';\nimport { timeSheetService } from '@/services/timesheetService';\nimport type { TimeSheetRow } from '@/types';\nimport PageContainer from '@/components/ui/PageContainer';\nimport SectionCard from '@/components/ui/SectionCard';\nimport { standardDataGridSx } from '@/components/ui/dataGridStyles';\nimport ConfirmDialog from '@/components/ui/ConfirmDialog';\nimport EmptyState from '@/components/ui/EmptyState';\n\nconst TeamLeadAssigned: React.FC = () => {\n  const [paginationModel, setPaginationModel] = React.useState<{ page: number; pageSize: number }>({ page: 0, pageSize: 10 });\n\n  const { data, isLoading, isError, refetch } = useQuery({\n    queryKey: ['timesheets', 'teamlead-assigned-rows', paginationModel.page, paginationModel.pageSize],\n    queryFn: async () => timeSheetService.getTeamLeadAssignedRows({ page: paginationModel.page, size: paginationModel.pageSize }),\n    placeholderData: keepPreviousData,\n  });\n\n  const approveRowMutation = useMutation({\n    mutationFn: ({ timesheetId, rowId }: { timesheetId: number; rowId: number }) =>\n      timeSheetService.approveRow(timesheetId, rowId),\n    onSuccess: () => refetch(),\n  });\n\n  const rejectRowMutation = useMutation({\n    mutationFn: ({ timesheetId, rowId, reason }: { timesheetId: number; rowId: number; reason: string }) =>\n      timeSheetService.rejectRow(timesheetId, rowId, reason),\n    onSuccess: () => refetch(),\n  });\n\n  const rows: TimeSheetRow[] = data?.content ?? [];\n  const rowCount = data?.totalElements ?? 0;\n\n  const [rejectOpen, setRejectOpen] = React.useState(false);\n  const [rejectRowId, setRejectRowId] = React.useState<number | null>(null);\n  const [rejectReason, setRejectReason] = React.useState('');\n\n  const columns = React.useMemo<GridColDef<TimeSheetRow>[]>(\n    () => [\n      { field: 'id', headerName: 'Row ID', width: 100 },\n      { field: 'timesheetId', headerName: 'Timesheet ID', width: 130 },\n      { field: 'workDate', headerName: 'Date', width: 120 },\n      { field: 'hours', headerName: 'Hours', width: 100 },\n      { field: 'status', headerName: 'Status', width: 160 },\n      { field: 'assignedToName', headerName: 'Assigned To', width: 180 },\n      {\n        field: 'actions',\n        headerName: 'Actions',\n        width: 240,\n        sortable: false,\n        renderCell: (params) => (\n          <Stack direction=\"row\" spacing={1}>\n            <Button\n              size=\"small\"\n              variant=\"contained\"\n              onClick={() => approveRowMutation.mutate({ timesheetId: params.row.timesheetId, rowId: params.row.id })}\n              disabled={\n                approveRowMutation.isPending ||\n                ['TEAM_LEAD_APPROVE', 'TEAM_LEAD_REJECT', 'COMPLETED', 'ADMIN_REJECTED'].includes(String(params.row.status)) ||\n                !params.row.assignedToEmployeeId\n              }\n            >\n              Approve\n            </Button>\n            <Button\n              size=\"small\"\n              variant=\"outlined\"\n              color=\"error\"\n              onClick={() => { setRejectRowId(params.row.id); setRejectReason(''); setRejectOpen(true); }}\n              disabled={\n                rejectRowMutation.isPending ||\n                ['TEAM_LEAD_APPROVE', 'TEAM_LEAD_REJECT', 'COMPLETED', 'ADMIN_REJECTED'].includes(String(params.row.status)) ||\n                !params.row.assignedToEmployeeId\n              }\n            >\n              Reject\n            </Button>\n          </Stack>\n        ),\n      },\n    ],\n    [approveRowMutation.isPending, rejectRowMutation.isPending]\n  );\n\n  const handlePaginationChange = (model: GridPaginationModel) => {\n    setPaginationModel({ page: model.page, pageSize: model.pageSize });\n  };\n\n  const NoAssignedOverlay = React.useCallback(() => (\n    <EmptyState\n      title=\"No assigned rows\"\n      description=\"There are no timesheet rows assigned to you.\"\n    />\n  ), [refetch]);\n\n  return (\n    <PageContainer title=\"TeamLead Assigned Rows\" actions={<Button variant=\"outlined\" onClick={() => refetch()}>Refresh</Button>}>\n      <SectionCard>\n        <Box sx={{ height: 600, width: '100%' }}>\n          <DataGrid\n            rows={rows}\n            columns={columns}\n            getRowId={(row) => row.id}\n            loading={isLoading}\n            paginationMode=\"server\"\n            rowCount={rowCount}\n            pageSizeOptions={[5, 10, 25, 50]}\n            paginationModel={{ page: paginationModel.page, pageSize: paginationModel.pageSize }}\n            onPaginationModelChange={handlePaginationChange}\n            disableRowSelectionOnClick\n            sx={standardDataGridSx}\n            slots={{ noRowsOverlay: NoAssignedOverlay }}\n          />\n        </Box>\n        {isError && (\n          <Typography variant=\"body2\" color=\"error\" sx={{ mt: 2 }}>\n            Failed to load assigned rows.\n          </Typography>\n        )}\n      </SectionCard>\n      <ConfirmDialog\n        open={rejectOpen}\n        title=\"Reject Row\"\n        description=\"Please provide a reason for rejection.\"\n        confirmLabel=\"Reject\"\n        confirmColor=\"error\"\n        loading={rejectRowMutation.isPending}\n        confirmDisabled={rejectReason.trim().length === 0}\n        onClose={() => setRejectOpen(false)}\n        onConfirm={() => {\n          if (rejectRowId && rejectReason.trim()) {\n            // timesheetId is available in rows list; use the selected row from rows state\n            const tsId = rows.find(r => r.id === rejectRowId)?.timesheetId;\n            if (tsId) {\n              rejectRowMutation.mutate({ timesheetId: tsId, rowId: rejectRowId, reason: rejectReason.trim() });\n              setRejectOpen(false);\n            }\n          }\n        }}\n      >\n        <TextField\n          autoFocus\n          fullWidth\n          label=\"Reason\"\n          multiline\n          minRows={2}\n          value={rejectReason}\n          error={rejectReason.trim().length === 0}\n          helperText={rejectReason.trim().length === 0 ? 'Reason is required' : ''}\n          onChange={(e) => setRejectReason(e.target.value)}\n        />\n      </ConfirmDialog>\n    </PageContainer>\n  );\n};\n\nexport default TeamLeadAssigned;\n"],"names":["TeamLeadAssigned","paginationModel","setPaginationModel","React","data","isLoading","isError","refetch","useQuery","timeSheetService","keepPreviousData","approveRowMutation","useMutation","timesheetId","rowId","rejectRowMutation","reason","rows","rowCount","rejectOpen","setRejectOpen","rejectRowId","setRejectRowId","rejectReason","setRejectReason","columns","params","jsxs","Stack","jsx","Button","handlePaginationChange","model","NoAssignedOverlay","EmptyState","PageContainer","SectionCard","Box","DataGrid","row","standardDataGridSx","Typography","ConfirmDialog","tsId","_a","r","TextField"],"mappings":"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"}