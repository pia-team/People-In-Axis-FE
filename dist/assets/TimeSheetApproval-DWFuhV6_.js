import{j as t,O as N,V as l,B as k,g as D,a8 as E}from"./mui-CYe98n_K.js";import{c as o,u as F}from"./vendor-XBP3t-ED.js";import{b as f,t as d,k as O}from"./index--2Lk4t6e.js";import{u as j}from"./useMutation-DaHtIydk.js";import{P as T}from"./PageContainer-BfQWlLPL.js";import{S as q}from"./SectionCard-4aLOeFJ3.js";import{E as A,s as B}from"./dataGridStyles-CXweFaFc.js";import{C as W}from"./ConfirmDialog-Xg6DaLa-.js";import{D as I}from"./DataGrid-BXsRbnco.js";import"./utils-BgeKWveL.js";const Y=()=>{const[a,S]=o.useState({page:0,pageSize:10}),{data:i,isLoading:x,isError:C,refetch:s}=f({queryKey:["timesheets","manager-pending",a.page,a.pageSize],queryFn:async()=>d.getManagerPending({page:a.page,size:a.pageSize}),placeholderData:O}),{data:g}=f({queryKey:["timesheets","manager-pending","count"],queryFn:d.getManagerPendingCount}),c=j({mutationFn:({id:e,comments:p})=>d.approve(e,p),onSuccess:()=>s()}),r=j({mutationFn:({id:e,reason:p})=>d.reject(e,p),onSuccess:()=>s()}),v=F(),w=(i==null?void 0:i.content)??[],y=(i==null?void 0:i.totalElements)??0,[P,m]=o.useState(!1),[u,R]=o.useState(null),[n,h]=o.useState(""),b=o.useMemo(()=>[{field:"employeeName",headerName:"Employee",flex:1.2,minWidth:160},{field:"projectName",headerName:"Project",flex:1.2,minWidth:160},{field:"workDate",headerName:"Date",width:120},{field:"hoursWorked",headerName:"Hours",width:100},{field:"status",headerName:"Status",width:140},{field:"baseStatus",headerName:"Base Status",width:180,valueFormatter:({value:e})=>e==="COMPLETED"?"Closed":e},{field:"actions",headerName:"Actions",width:220,sortable:!1,renderCell:e=>t.jsxs(N,{direction:"row",spacing:1,children:[t.jsx(l,{size:"small",variant:"text",onClick:()=>v(`/timesheets/${e.row.id}`),children:"Details"}),t.jsx(l,{size:"small",variant:"contained",onClick:()=>c.mutate({id:e.row.id}),disabled:c.isPending,children:"Approve"}),t.jsx(l,{size:"small",variant:"outlined",color:"error",onClick:()=>{R(e.row.id),h(""),m(!0)},disabled:r.isPending,children:"Reject"})]})}],[c.isPending,r.isPending]),z=e=>{S({page:e.page,pageSize:e.pageSize})},M=o.useCallback(()=>t.jsx(A,{title:"No pending timesheets",description:"There are no timesheets awaiting your approval."}),[s]);return t.jsxs(T,{title:`TimeSheet Approval${typeof g=="number"?` (Pending: ${g})`:""}`,actions:t.jsx(l,{variant:"outlined",onClick:()=>s(),children:"Refresh"}),children:[t.jsxs(q,{children:[t.jsx(k,{sx:{height:600,width:"100%"},children:t.jsx(I,{rows:w,columns:b,getRowId:e=>e.id,loading:x,paginationMode:"server",rowCount:y,pageSizeOptions:[5,10,25,50],paginationModel:{page:a.page,pageSize:a.pageSize},onPaginationModelChange:z,disableRowSelectionOnClick:!0,sx:B,slots:{noRowsOverlay:M}})}),C&&t.jsx(D,{variant:"body2",color:"error",sx:{mt:2},children:"Failed to load pending timesheets."})]}),t.jsx(W,{open:P,title:"Reject Timesheet",description:"Please provide a reason for rejection.",confirmLabel:"Reject",confirmColor:"error",loading:r.isPending,confirmDisabled:n.trim().length===0,onClose:()=>m(!1),onConfirm:()=>{u&&n.trim()&&(r.mutate({id:u,reason:n.trim()}),m(!1))},children:t.jsx(E,{autoFocus:!0,fullWidth:!0,label:"Reason",multiline:!0,minRows:2,value:n,error:n.trim().length===0,helperText:n.trim().length===0?"Reason is required":"",onChange:e=>h(e.target.value)})})]})};export{Y as default};
//# sourceMappingURL=TimeSheetApproval-DWFuhV6_.js.map
