import{j as i,O as T,V as c,B as A,g as I,a8 as b}from"./mui-CYe98n_K.js";import{c as t}from"./vendor-XBP3t-ED.js";import{b as W,k as q}from"./index--2Lk4t6e.js";import{u as f}from"./useMutation-DaHtIydk.js";import{e as p}from"./expenseService-YharjWb-.js";import{P as B}from"./PageContainer-BfQWlLPL.js";import{S as L}from"./SectionCard-4aLOeFJ3.js";import{E as G,s as K}from"./dataGridStyles-CXweFaFc.js";import{C as v}from"./ConfirmDialog-Xg6DaLa-.js";import{D as Q}from"./DataGrid-BXsRbnco.js";import"./utils-BgeKWveL.js";const te=()=>{const[n,C]=t.useState({page:0,pageSize:10}),{data:a,isLoading:y,isError:P,refetch:r}=W({queryKey:["expenses","pending",n.page,n.pageSize],queryFn:async()=>p.getPending({page:n.page,size:n.pageSize}),placeholderData:q}),m=f({mutationFn:({id:e,comments:s})=>p.approve(e,s),onSuccess:()=>r()}),l=f({mutationFn:({id:e,reason:s})=>p.reject(e,s),onSuccess:()=>r()}),d=f({mutationFn:({id:e,reference:s})=>p.reimburse(e,s),onSuccess:()=>r()}),w=(a==null?void 0:a.content)??[],N=(a==null?void 0:a.totalElements)??0,[z,u]=t.useState(!1),[h,E]=t.useState(null),[o,x]=t.useState(""),[M,g]=t.useState(!1),[j,k]=t.useState(null),[R,S]=t.useState(""),D=t.useMemo(()=>[{field:"employeeName",headerName:"Employee",flex:1.2,minWidth:160},{field:"expenseTypeName",headerName:"Type",flex:1,minWidth:140},{field:"projectName",headerName:"Project",flex:1.2,minWidth:160},{field:"expenseDate",headerName:"Date",width:120},{field:"amount",headerName:"Amount",width:120},{field:"currency",headerName:"Currency",width:100},{field:"status",headerName:"Status",width:140},{field:"actions",headerName:"Actions",width:320,sortable:!1,renderCell:e=>i.jsxs(T,{direction:"row",spacing:1,children:[i.jsx(c,{size:"small",variant:"contained",onClick:()=>m.mutate({id:e.row.id}),disabled:m.isPending,children:"Approve"}),i.jsx(c,{size:"small",variant:"outlined",color:"error",onClick:()=>{E(e.row.id),x(""),u(!0)},disabled:l.isPending,children:"Reject"}),i.jsx(c,{size:"small",variant:"outlined",onClick:()=>{k(e.row.id),S(""),g(!0)},disabled:d.isPending,children:"Reimburse"})]})}],[m.isPending,l.isPending,d.isPending]),O=e=>{C({page:e.page,pageSize:e.pageSize})},F=t.useCallback(()=>i.jsx(G,{title:"No pending expenses",description:"There are no expenses awaiting your approval."}),[r]);return i.jsxs(B,{title:"Expense Approval",actions:i.jsx(c,{variant:"outlined",onClick:()=>r(),children:"Refresh"}),children:[i.jsxs(L,{children:[i.jsx(A,{sx:{height:600,width:"100%"},children:i.jsx(Q,{rows:w,columns:D,getRowId:e=>e.id,loading:y,paginationMode:"server",rowCount:N,pageSizeOptions:[5,10,25,50],paginationModel:{page:n.page,pageSize:n.pageSize},onPaginationModelChange:O,disableRowSelectionOnClick:!0,sx:K,slots:{noRowsOverlay:F}})}),P&&i.jsx(I,{variant:"body2",color:"error",sx:{mt:2},children:"Failed to load pending expenses."})]}),i.jsx(v,{open:z,title:"Reject Expense",description:"Please provide a reason for rejection.",confirmLabel:"Reject",confirmColor:"error",loading:l.isPending,confirmDisabled:o.trim().length===0,onClose:()=>u(!1),onConfirm:()=>{h&&o.trim()&&(l.mutate({id:h,reason:o.trim()}),u(!1))},children:i.jsx(b,{autoFocus:!0,fullWidth:!0,label:"Reason",multiline:!0,minRows:2,value:o,error:o.trim().length===0,helperText:o.trim().length===0?"Reason is required":"",onChange:e=>x(e.target.value)})}),i.jsx(v,{open:M,title:"Reimburse Expense",description:"You can optionally provide a reimbursement reference.",confirmLabel:"Reimburse",confirmColor:"primary",loading:d.isPending,onClose:()=>g(!1),onConfirm:()=>{if(j){const e=R.trim();d.mutate({id:j,reference:e===""?void 0:e}),g(!1)}},children:i.jsx(b,{autoFocus:!0,fullWidth:!0,label:"Reference (optional)",value:R,onChange:e=>S(e.target.value)})})]})};export{te as default};
//# sourceMappingURL=ExpenseApproval-C8Kqsc80.js.map
