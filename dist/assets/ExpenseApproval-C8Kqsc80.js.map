{"version":3,"file":"ExpenseApproval-C8Kqsc80.js","sources":["../../src/pages/expenses/ExpenseApproval.tsx"],"sourcesContent":["import React from 'react';\nimport { Box, Typography, Stack, Button, TextField } from '@mui/material';\nimport { DataGrid, GridColDef, GridPaginationModel } from '@mui/x-data-grid';\nimport { useQuery, useMutation, keepPreviousData } from '@tanstack/react-query';\nimport { expenseService } from '@/services/expenseService';\nimport { Expense } from '@/types';\nimport PageContainer from '@/components/ui/PageContainer';\nimport SectionCard from '@/components/ui/SectionCard';\nimport { standardDataGridSx } from '@/components/ui/dataGridStyles';\nimport ConfirmDialog from '@/components/ui/ConfirmDialog';\nimport EmptyState from '@/components/ui/EmptyState';\n\nconst ExpenseApproval: React.FC = () => {\n  const [paginationModel, setPaginationModel] = React.useState<{ page: number; pageSize: number }>(\n    { page: 0, pageSize: 10 }\n  );\n\n  const { data, isLoading, isError, refetch } = useQuery({\n    queryKey: ['expenses', 'pending', paginationModel.page, paginationModel.pageSize],\n    queryFn: async () => expenseService.getPending({ page: paginationModel.page, size: paginationModel.pageSize }),\n    placeholderData: keepPreviousData,\n  });\n\n  const approveMutation = useMutation({\n    mutationFn: ({ id, comments }: { id: number; comments?: string }) => expenseService.approve(id, comments),\n    onSuccess: () => refetch(),\n  });\n\n  const rejectMutation = useMutation({\n    mutationFn: ({ id, reason }: { id: number; reason: string }) => expenseService.reject(id, reason),\n    onSuccess: () => refetch(),\n  });\n\n  const reimburseMutation = useMutation({\n    mutationFn: ({ id, reference }: { id: number; reference?: string }) => expenseService.reimburse(id, reference),\n    onSuccess: () => refetch(),\n  });\n\n  const rows: Expense[] = data?.content ?? [];\n  const rowCount = data?.totalElements ?? 0;\n\n  const [rejectOpen, setRejectOpen] = React.useState(false);\n  const [rejectId, setRejectId] = React.useState<number | null>(null);\n  const [rejectReason, setRejectReason] = React.useState('');\n  const [reimburseOpen, setReimburseOpen] = React.useState(false);\n  const [reimburseId, setReimburseId] = React.useState<number | null>(null);\n  const [reimburseRef, setReimburseRef] = React.useState('');\n\n  const columns = React.useMemo<GridColDef<Expense>[]>(\n    () => [\n      { field: 'employeeName', headerName: 'Employee', flex: 1.2, minWidth: 160 },\n      { field: 'expenseTypeName', headerName: 'Type', flex: 1, minWidth: 140 },\n      { field: 'projectName', headerName: 'Project', flex: 1.2, minWidth: 160 },\n      { field: 'expenseDate', headerName: 'Date', width: 120 },\n      { field: 'amount', headerName: 'Amount', width: 120 },\n      { field: 'currency', headerName: 'Currency', width: 100 },\n      { field: 'status', headerName: 'Status', width: 140 },\n      {\n        field: 'actions',\n        headerName: 'Actions',\n        width: 320,\n        sortable: false,\n        renderCell: (params) => (\n          <Stack direction=\"row\" spacing={1}>\n            <Button\n              size=\"small\"\n              variant=\"contained\"\n              onClick={() => approveMutation.mutate({ id: params.row.id })}\n              disabled={approveMutation.isPending}\n            >\n              Approve\n            </Button>\n            <Button\n              size=\"small\"\n              variant=\"outlined\"\n              color=\"error\"\n              onClick={() => { setRejectId(params.row.id); setRejectReason(''); setRejectOpen(true); }}\n              disabled={rejectMutation.isPending}\n            >\n              Reject\n            </Button>\n            <Button\n              size=\"small\"\n              variant=\"outlined\"\n              onClick={() => { setReimburseId(params.row.id); setReimburseRef(''); setReimburseOpen(true); }}\n              disabled={reimburseMutation.isPending}\n            >\n              Reimburse\n            </Button>\n          </Stack>\n        ),\n      },\n    ],\n    [approveMutation.isPending, rejectMutation.isPending, reimburseMutation.isPending]\n  );\n\n  const handlePaginationChange = (model: GridPaginationModel) => {\n    setPaginationModel({ page: model.page, pageSize: model.pageSize });\n  };\n\n  const NoPendingOverlay = React.useCallback(() => (\n    <EmptyState\n      title=\"No pending expenses\"\n      description=\"There are no expenses awaiting your approval.\"\n    />\n  ), [refetch]);\n\n  return (\n    <PageContainer title=\"Expense Approval\" actions={<Button variant=\"outlined\" onClick={() => refetch()}>Refresh</Button>}>\n      <SectionCard>\n        <Box sx={{ height: 600, width: '100%' }}>\n          <DataGrid\n            rows={rows}\n            columns={columns}\n            getRowId={(row) => row.id}\n            loading={isLoading}\n            paginationMode=\"server\"\n            rowCount={rowCount}\n            pageSizeOptions={[5, 10, 25, 50]}\n            paginationModel={{ page: paginationModel.page, pageSize: paginationModel.pageSize }}\n            onPaginationModelChange={handlePaginationChange}\n            disableRowSelectionOnClick\n            sx={standardDataGridSx}\n            slots={{ noRowsOverlay: NoPendingOverlay }}\n          />\n        </Box>\n        {isError && (\n          <Typography variant=\"body2\" color=\"error\" sx={{ mt: 2 }}>\n            Failed to load pending expenses.\n          </Typography>\n        )}\n      </SectionCard>\n      <ConfirmDialog\n        open={rejectOpen}\n        title=\"Reject Expense\"\n        description=\"Please provide a reason for rejection.\"\n        confirmLabel=\"Reject\"\n        confirmColor=\"error\"\n        loading={rejectMutation.isPending}\n        confirmDisabled={rejectReason.trim().length === 0}\n        onClose={() => setRejectOpen(false)}\n        onConfirm={() => {\n          if (rejectId && rejectReason.trim()) {\n            rejectMutation.mutate({ id: rejectId, reason: rejectReason.trim() });\n            setRejectOpen(false);\n          }\n        }}\n      >\n        <TextField\n          autoFocus\n          fullWidth\n          label=\"Reason\"\n          multiline\n          minRows={2}\n          value={rejectReason}\n          error={rejectReason.trim().length === 0}\n          helperText={rejectReason.trim().length === 0 ? 'Reason is required' : ''}\n          onChange={(e) => setRejectReason(e.target.value)}\n        />\n      </ConfirmDialog>\n      <ConfirmDialog\n        open={reimburseOpen}\n        title=\"Reimburse Expense\"\n        description=\"You can optionally provide a reimbursement reference.\"\n        confirmLabel=\"Reimburse\"\n        confirmColor=\"primary\"\n        loading={reimburseMutation.isPending}\n        onClose={() => setReimburseOpen(false)}\n        onConfirm={() => {\n          if (reimburseId) {\n            const ref = reimburseRef.trim();\n            reimburseMutation.mutate({ id: reimburseId, reference: ref === '' ? undefined : ref });\n            setReimburseOpen(false);\n          }\n        }}\n      >\n        <TextField\n          autoFocus\n          fullWidth\n          label=\"Reference (optional)\"\n          value={reimburseRef}\n          onChange={(e) => setReimburseRef(e.target.value)}\n        />\n      </ConfirmDialog>\n    </PageContainer>\n  );\n};\n\nexport default ExpenseApproval;"],"names":["ExpenseApproval","paginationModel","setPaginationModel","React","data","isLoading","isError","refetch","useQuery","expenseService","keepPreviousData","approveMutation","useMutation","id","comments","rejectMutation","reason","reimburseMutation","reference","rows","rowCount","rejectOpen","setRejectOpen","rejectId","setRejectId","rejectReason","setRejectReason","reimburseOpen","setReimburseOpen","reimburseId","setReimburseId","reimburseRef","setReimburseRef","columns","params","jsxs","Stack","jsx","Button","handlePaginationChange","model","NoPendingOverlay","EmptyState","PageContainer","SectionCard","Box","DataGrid","row","standardDataGridSx","Typography","ConfirmDialog","TextField","ref"],"mappings":"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"}