{"version":3,"file":"TimeSheetForm-Bg-A-NYi.js","sources":["../../src/pages/timesheets/TimeSheetForm.tsx"],"sourcesContent":["import React from 'react';\nimport { Box, Typography, Stack, Button, Divider, Alert, Table, TableHead, TableRow, TableCell, TableBody } from '@mui/material';\nimport { useMutation } from '@tanstack/react-query';\nimport { timeSheetService } from '@/services/timesheetService';\nimport { TimeSheetImportResult } from '@/types';\nimport PageContainer from '@/components/ui/PageContainer';\nimport SectionCard from '@/components/ui/SectionCard';\n\nconst TimeSheetForm: React.FC = () => {\n  const [file, setFile] = React.useState<File | null>(null);\n  const [result, setResult] = React.useState<string>('');\n  const [importResult, setImportResult] = React.useState<TimeSheetImportResult | null>(null);\n\n  const { mutateAsync: importExcel, isPending } = useMutation({\n    mutationFn: async (f: File) => timeSheetService.importExcel(f),\n  });\n\n  const { mutateAsync: downloadTemplate, isPending: isTplPending } = useMutation({\n    mutationFn: async () => timeSheetService.downloadImportTemplate(),\n  });\n\n  const onUpload = async () => {\n    setResult('');\n    setImportResult(null);\n    if (!file) return;\n    try {\n      const res = await importExcel(file);\n      setImportResult(res);\n      setResult(`Imported ${res.importedCount} of ${res.totalRows}. Failed: ${res.failedCount}`);\n    } catch (e) {\n      setResult('Import failed.');\n    }\n  };\n\n  const onDownloadTemplate = async () => {\n    const blob = await downloadTemplate();\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'timesheet-import-template.xlsx';\n    document.body.appendChild(a);\n    a.click();\n    a.remove();\n    window.URL.revokeObjectURL(url);\n  };\n\n  return (\n    <PageContainer title=\"Import TimeSheets from Excel\">\n      <SectionCard>\n        <Stack spacing={2}>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            Choose an .xlsx file to import timesheets. After a successful import, check the TimeSheets list.\n          </Typography>\n          <Stack direction=\"row\" spacing={2}>\n            <Button variant=\"outlined\" onClick={onDownloadTemplate} disabled={isTplPending}>\n              Download Template\n            </Button>\n          </Stack>\n          <Typography variant=\"subtitle2\">Template Guidelines</Typography>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            - EmployeeId (required): Sistemde var olan çalışan ID’si\n          </Typography>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            - ProjectId (optional): İlgili proje ID’si (boş bırakılabilir)\n          </Typography>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            - WorkDate (required): Tarih formatı YYYY-MM-DD (örn. 2024-09-09)\n          </Typography>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            - HoursWorked (optional): 7.5 gibi ondalıklı değer kabul eder\n          </Typography>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            - EmployeeName/ProjectName sütunları rehber amaçlıdır, import sırasında dikkate alınmaz\n          </Typography>\n          <input type=\"file\" accept=\".xlsx,.xls\" onChange={(e) => setFile(e.target.files?.[0] ?? null)} />\n          <Stack direction=\"row\" spacing={2}>\n            <Button variant=\"contained\" onClick={onUpload} disabled={!file || isPending}>Upload</Button>\n            {result && <Typography>{result}</Typography>}\n          </Stack>\n\n          {importResult && (\n            <Box>\n              <Divider sx={{ my: 2 }} />\n              <Alert severity={importResult.failedCount > 0 ? 'warning' : 'success'}>\n                Total: {importResult.totalRows} | Imported: {importResult.importedCount} | Failed: {importResult.failedCount}\n              </Alert>\n\n              {importResult.successRows?.length > 0 && (\n                <Box mt={2}>\n                  <Typography variant=\"subtitle1\">Successful Rows ({importResult.successRows.length})</Typography>\n                  <Table size=\"small\">\n                    <TableHead>\n                      <TableRow>\n                        <TableCell>Row</TableCell>\n                        <TableCell>EmployeeId</TableCell>\n                        <TableCell>ProjectId</TableCell>\n                        <TableCell>WorkDate</TableCell>\n                        <TableCell>Hours</TableCell>\n                        <TableCell>TimeSheetId</TableCell>\n                        <TableCell>Message</TableCell>\n                      </TableRow>\n                    </TableHead>\n                    <TableBody>\n                      {importResult.successRows.map((r, idx) => (\n                        <TableRow key={`s-${idx}`}>\n                          <TableCell>{r.rowNumber}</TableCell>\n                          <TableCell>{r.employeeId ?? ''}</TableCell>\n                          <TableCell>{r.projectId ?? ''}</TableCell>\n                          <TableCell>{r.workDate ?? ''}</TableCell>\n                          <TableCell>{r.hoursWorked ?? ''}</TableCell>\n                          <TableCell>{r.timeSheetId ?? ''}</TableCell>\n                          <TableCell>{r.message ?? ''}</TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </Box>\n              )}\n\n              {importResult.failedRows?.length > 0 && (\n                <Box mt={2}>\n                  <Typography variant=\"subtitle1\">Failed Rows ({importResult.failedRows.length})</Typography>\n                  <Table size=\"small\">\n                    <TableHead>\n                      <TableRow>\n                        <TableCell>Row</TableCell>\n                        <TableCell>EmployeeId</TableCell>\n                        <TableCell>ProjectId</TableCell>\n                        <TableCell>WorkDate</TableCell>\n                        <TableCell>Hours</TableCell>\n                        <TableCell>Message</TableCell>\n                      </TableRow>\n                    </TableHead>\n                    <TableBody>\n                      {importResult.failedRows.map((r, idx) => (\n                        <TableRow key={`f-${idx}`}>\n                          <TableCell>{r.rowNumber}</TableCell>\n                          <TableCell>{r.employeeId ?? ''}</TableCell>\n                          <TableCell>{r.projectId ?? ''}</TableCell>\n                          <TableCell>{r.workDate ?? ''}</TableCell>\n                          <TableCell>{r.hoursWorked ?? ''}</TableCell>\n                          <TableCell>{r.message ?? ''}</TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </Box>\n              )}\n            </Box>\n          )}\n        </Stack>\n      </SectionCard>\n    </PageContainer>\n  );\n};\n\nexport default TimeSheetForm;"],"names":["TimeSheetForm","file","setFile","React","result","setResult","importResult","setImportResult","importExcel","isPending","useMutation","f","timeSheetService","downloadTemplate","isTplPending","onUpload","res","onDownloadTemplate","blob","url","a","jsx","PageContainer","SectionCard","jsxs","Stack","Typography","Button","e","_a","Box","Divider","Alert","Table","TableHead","TableRow","TableCell","TableBody","r","idx","_b"],"mappings":"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"}